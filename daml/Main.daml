module Main where
import Daml.Script
import DA.Date

type Thumbnail = Text   -- Base64

data Parties = Parties
    with
        seller : Party
        buyer : Party
    deriving (Eq, Show)

data Property = Property
    with
        streetAddress : Text
        county : Text
        taxId : Text
        legalDescr : Text
        personalProperty : Text
        excludedItems : Text
        thumbnail : Thumbnail
    deriving (Eq, Show)

data EscrowAgent = EscrowAgent
    with
        name : Text
        address : Text
        phone : Text
        email : Text
        fax : Text
    deriving (Eq, Show)
        
data Terms = Terms
    with
        purchasePrice : Decimal
        initialDeposit : Decimal
        initialDepositTime : Int
        balanceToClose : Decimal
        timeForAcceptance : Date
        closingDate : Date
        isAssignable : Text
        titleEvidenceDeadline : Int
        whoDesignatesClosingAgent : Text
        inspectionPeriod : Int
        additionalTerms : Text
        offerIsCountered : Bool
        offerIsRejected : Bool
        counterofferIsCountered : Bool
        counterofferIsRejected : Bool
    deriving (Eq, Show)


template SellerAgencyProposal
    with
        seller : Party
        sellerAgent : Party
        property : Property
        listPrice : Decimal
    where
        signatory sellerAgent

        controller seller can
                AcceptSellerAgency: ContractId SellerAgencyCreated
                    do
                        create SellerAgencyCreated with
                            seller
                            sellerAgent
                            property
                            listPrice

template SellerAgencyCreated
    with
        seller : Party
        sellerAgent : Party
        property : Property
        listPrice : Decimal
    where
        signatory seller, sellerAgent
    
        controller sellerAgent can
            nonconsuming PrepareListing: ContractId PreparedListing
                do
                    create PreparedListing with
                        seller
                        property
                        listPrice
                        sellerAgent

template PreparedListing
    with
        seller : Party
        property : Property
        listPrice : Decimal
        sellerAgent : Party
    where
        signatory sellerAgent
    
        controller seller can
            ApproveListing: ContractId ApprovedListing
                do
                    create ApprovedListing with
                        seller
                        property
                        listPrice
                        sellerAgent

template ApprovedListing
    with
        seller : Party
        property : Property
        listPrice : Decimal
        sellerAgent : Party
    where
        signatory seller, sellerAgent


template BuyerAgencyProposal
    with
        buyer : Party
        buyerAgent : Party
    where
        signatory buyerAgent

        controller buyer can
            AcceptBuyerAgency: ContractId BuyerAgencyCreated
                do
                    create BuyerAgencyCreated with
                        buyer
                        buyerAgent

template BuyerAgencyCreated
    with
        buyer : Party
        buyerAgent : Party
    where
        signatory buyer, buyerAgent
    
        controller buyerAgent can
            nonconsuming PrepareOffer: ContractId PreparedOffer
                with
                    parties : Parties
                    property : Property
                    escrowAgent : EscrowAgent
                    terms : Terms
                    sellerAgent : Party
                do
                    create PreparedOffer with
                        parties
                        property
                        escrowAgent
                        terms
                        sellerAgent
                        buyerAgent

template PreparedOffer
    with
        parties : Parties
        property : Property
        escrowAgent : EscrowAgent
        terms : Terms
        sellerAgent : Party
        buyerAgent : Party
    where
        signatory buyerAgent

        controller parties.buyer can
            ApproveOffer: ContractId TenderedOffer
                do
                    create TenderedOffer with
                        parties
                        property
                        escrowAgent
                        terms
                        sellerAgent
                        buyerAgent

template TenderedOffer
    with
        parties : Parties
        property : Property
        escrowAgent : EscrowAgent
        terms : Terms
        sellerAgent : Party
        buyerAgent : Party
    where
        signatory parties.buyer
        observer sellerAgent, buyerAgent

        controller parties.seller can
            AcceptOffer : ContractId ExecutedContract
                with
                    escrowAgentName : Party
                do
                    create ExecutedContract with
                        parties
                        property
                        escrowAgent
                        terms
                        sellerAgent
                        buyerAgent
                        escrowAgentName

            RejectOffer : ContractId TenderedOffer
                do
                    create this with
                        terms.offerIsRejected = True
            
            IndicateCounteroffer : ContractId TenderedOffer
                do
                    create this with
                        terms.offerIsCountered = True

template ExecutedContract
    with
        parties : Parties
        property : Property
        escrowAgent : EscrowAgent
        terms : Terms
        sellerAgent : Party
        buyerAgent : Party
        escrowAgentName : Party
    where
        signatory parties.seller, parties.buyer
        observer sellerAgent, buyerAgent, escrowAgentName

template PreparedCounteroffer
    with
        parties : Parties
        property : Property
        escrowAgent : EscrowAgent
        terms : Terms
        sellerAgent : Party
        buyerAgent : Party
    where
        signatory sellerAgent

        controller parties.seller can
                SignCounteroffer : ContractId TenderedCounteroffer
                    do
                        create TenderedCounteroffer with
                            parties
                            property
                            escrowAgent
                            terms
                            sellerAgent
                            buyerAgent

template TenderedCounteroffer
    with
        parties : Parties
        property : Property
        escrowAgent : EscrowAgent
        terms : Terms
        sellerAgent : Party
        buyerAgent : Party
    where
        signatory parties.seller
        observer buyerAgent

        controller parties.buyer can
                AcceptCounteroffer : ContractId ExecutedContract
                    with
                        escrowAgentName : Party
                    do
                        create ExecutedContract with
                            parties
                            property
                            escrowAgent
                            terms
                            sellerAgent
                            buyerAgent
                            escrowAgentName

                RejectCounteroffer : ContractId TenderedCounteroffer
                    do
                        create this with
                            terms.counterofferIsRejected = True

        controller buyerAgent can
                IndicateCounterToCounteroffer : ContractId TenderedCounteroffer
                    do
                        create this with
                            terms.counterofferIsCountered = True
                    

setup = script do
    alice <- allocateParty "Alice"  -- seller
    bob <- allocateParty "Bob"      -- buyer
    carol <- allocateParty "Carol"  -- buyerAgent
    david <- allocateParty "David"  -- sellerAgent
    faythe <- allocateParty "Faythe" -- escrowAgentName

    let
        property = Property with
            streetAddress = "123 Main St, Anywhere, FL 123456"
            county = "Orange"
            taxId = "1234567890"
            legalDescr = "Lot 1, Happy Homes Subdivision"
            personalProperty = "None"
            excludedItems = "None"
            thumbnail = "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"

    let
        escrowAgent = EscrowAgent with
            name = "Faythe"
            address = "456 Closing Ln., Anytown, Florida 123456"
            phone = "(123) 456-7890"
            email = "faythe@titlecompany.com"
            fax = "(123) 456-7891"

    offer03 <- submit david do
        createCmd SellerAgencyProposal with
            seller = alice
            sellerAgent = david
            property
            listPrice = 100000.00
    
    offer04 <- submit alice do
        exerciseCmd offer03 AcceptSellerAgency

    offer05 <- submit david do
        exerciseCmd offer04 PrepareListing

    offer06 <- submit alice do
        exerciseCmd offer05 ApproveListing

    offer07 <- submit carol do
        createCmd BuyerAgencyProposal with
            buyer = bob
            buyerAgent = carol
    
    offer08 <- submit bob do
        exerciseCmd offer07 AcceptBuyerAgency

    offer10 <- submit carol do
        let
            parties = Parties with
                seller = alice
                buyer = bob
        let
            terms = Terms with
                purchasePrice = 80000.00
                initialDeposit = 5000.00
                initialDepositTime = 3
                balanceToClose = 75000.00
                timeForAcceptance = date 2021 Oct 21
                closingDate = date 2021 Nov 15
                isAssignable = "No"
                titleEvidenceDeadline = 5
                whoDesignatesClosingAgent = "Seller"
                inspectionPeriod = 10
                additionalTerms = ""
                offerIsCountered = False
                offerIsRejected = False
                counterofferIsCountered = False
                counterofferIsRejected = False
    
        exerciseCmd offer08 PrepareOffer with
            parties
            property
            escrowAgent
            terms
            sellerAgent = david


    offer20 <- submit bob do
        exerciseCmd offer10 ApproveOffer

    offer25 <- submit alice do
        exerciseCmd offer20 IndicateCounteroffer

    offer26 <- submit bob do
        archiveCmd offer25
 
    offer30 <- submit david do
        let
            parties = Parties with
                seller = alice
                buyer = bob

            terms = Terms with
                purchasePrice = 90000.00
                initialDeposit = 5000.00
                initialDepositTime = 3
                balanceToClose = 85000.00
                timeForAcceptance = date 2021 Oct 21
                closingDate = date 2021 Nov 15
                isAssignable = "No"
                titleEvidenceDeadline = 5
                whoDesignatesClosingAgent = "Seller"
                inspectionPeriod = 10
                additionalTerms = ""
                offerIsCountered = True
                offerIsRejected = False
                counterofferIsCountered = False
                counterofferIsRejected = False
    
        createCmd PreparedCounteroffer with
            parties
            property
            escrowAgent
            terms
            sellerAgent = david
            buyerAgent = carol
   
    offer40 <- submit alice do
        exerciseCmd offer30 SignCounteroffer

    offer45 <- submit carol do
        exerciseCmd offer40 IndicateCounterToCounteroffer

    offer46 <- submit alice do
        archiveCmd offer45

    offer50 <- submit carol do
        let
            parties = Parties with
                seller = alice
                buyer = bob

            terms = Terms with
                purchasePrice = 87500.00
                initialDeposit = 5000.00
                initialDepositTime = 3
                balanceToClose = 82500.00
                timeForAcceptance = date 2021 Oct 21
                closingDate = date 2021 Nov 15
                isAssignable = "No"
                titleEvidenceDeadline = 5
                whoDesignatesClosingAgent = "Seller"
                inspectionPeriod = 10
                additionalTerms = ""
                offerIsCountered = False
                offerIsRejected = False
                counterofferIsCountered = True
                counterofferIsRejected = False

        createCmd PreparedOffer with
            parties
            property
            escrowAgent
            terms
            sellerAgent = david
            buyerAgent = carol

    offer55 <- submit bob do
        exerciseCmd offer50 ApproveOffer

    submit alice do
        exerciseCmd offer55 AcceptOffer with
            escrowAgentName = faythe
